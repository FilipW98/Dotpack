<section class="integrations-doubledV2">
    <div class="integrations-doubledV2__outer">
        <div class="integrations-doubledV2__inner">
            <div class="integrations-doubledV2__wrapper">
                <div class="integrations-doubledV2__carousel-border slide-to-right animate">
                    <div class="integrations-doubledV2__carousel-wrapper">
                        <div class="integrations-doubledV2__carousel-big">
                            <div class="integrations-doubledV2__svg-big">
                                <div class="integrations-doubledV2__circle-move-big"></div>
                                <svg width="494" height="494" viewBox="0 0 494 494" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M399.677 53.5857C506.38 138.024 524.429 292.974 439.99 399.677C355.552 506.38 200.602 524.429 93.8991 439.99C-12.8036 355.552 -30.8525 200.602 53.5857 93.8991C138.024 -12.8036 292.974 -30.8525 399.677 53.5857Z"
                                        stroke="url(#paint0_linear_779_3263)" stroke-width="0.8" />
                                    <defs>
                                        <linearGradient id="paint0_linear_779_3263" x1="-53.4863" y1="228.559"
                                            x2="587.657" y2="153.878" gradientUnits="userSpaceOnUse">
                                            <stop stop-color="#7209B7" />
                                            <stop offset="0.328791" stop-color="white" />
                                            <stop offset="0.508765" stop-color="#E4D0F1" />
                                            <stop offset="0.717957" stop-color="white" />
                                            <stop offset="0.861703" stop-color="#7209B7" />
                                            <stop offset="0.952858" stop-color="#A7A2A2" />
                                        </linearGradient>
                                    </defs>
                                </svg>
                            </div>
                            <div class="integrations-doubledV2__box-logo logo-3">
                                <?php 
                                $image = get_field('integrations-doubledV2-logo-1');
                                $size = 'full';
                                $attr = array('class' => 'logo');
                                if($image){
                                    echo wp_get_attachment_image($image, $size, false, $attr);
                                }
                                ?>
                            </div>
                            <div class="integrations-doubledV2__box-logo logo-4">
                                <?php 
                                $image = get_field('integrations-doubledV2-logo-2');
                                $size = 'full';
                                $attr = array('class' => 'logo');
                                if($image){
                                    echo wp_get_attachment_image($image, $size, false, $attr);
                                }
                                ?>
                            </div>
                            <div class="integrations-doubledV2__box-logo logo-5">
                                <?php 
                                $image = get_field('integrations-doubledV2-logo-3');
                                $size = 'full';
                                $attr = array('class' => 'logo');
                                if($image){
                                    echo wp_get_attachment_image($image, $size, false, $attr);
                                }
                                ?>
                            </div>
                            <div class="integrations-doubledV2__box-logo logo-6">
                                <?php 
                                $image = get_field('integrations-doubledV2-logo-4');
                                $size = 'full';
                                $attr = array('class' => 'logo');
                                if($image){
                                    echo wp_get_attachment_image($image, $size, false, $attr);
                                }
                                ?>
                            </div>
                            <div class="integrations-doubledV2__box-logo logo-7">
                                <?php 
                                $image = get_field('integrations-doubledV2-logo-5');
                                $size = 'full';
                                $attr = array('class' => 'logo');
                                if($image){
                                    echo wp_get_attachment_image($image, $size, false, $attr);
                                }
                                ?>
                            </div>
                            <div class="integrations-doubledV2__box-logo logo-8">
                                <?php 
                                $image = get_field('integrations-doubledV2-logo-6');
                                $size = 'full';
                                $attr = array('class' => 'logo');
                                if($image){
                                    echo wp_get_attachment_image($image, $size, false, $attr);
                                }
                                ?>
                            </div>

                        </div>
                        <div class="integrations-doubledV2__box-logo center"></div>
                        <div class="integrations-doubledV2__carousel-small">
                            <div class="integrations-doubledV2__svg-small">
                                <div class="integrations-doubledV2__circle-move-small"></div>
                                <svg width="304" height="304" viewBox="0 0 304 304" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M246.071 33.1246C311.724 85.0786 322.829 180.418 270.875 246.071C218.921 311.724 123.582 322.829 57.929 270.875C-7.72404 218.921 -18.8293 123.582 33.1246 57.929C85.0786 -7.72404 180.418 -18.8293 246.071 33.1246Z"
                                        stroke="url(#paint0_linear_779_3264)" stroke-width="0.8" />
                                    <defs>
                                        <linearGradient id="paint0_linear_779_3264" x1="-32.9429" y1="140.773"
                                            x2="361.946" y2="94.7752" gradientUnits="userSpaceOnUse">
                                            <stop stop-color="#7209B7" />
                                            <stop offset="0.328791" stop-color="white" />
                                            <stop offset="0.508765" stop-color="#E4D0F1" />
                                            <stop offset="0.717957" stop-color="white" />
                                            <stop offset="0.861703" stop-color="#7209B7" />
                                            <stop offset="0.952858" stop-color="#A7A2A2" />
                                        </linearGradient>
                                    </defs>
                                </svg>
                            </div>
                            <div class="integrations-doubledV2__box-logo logo-1-2">
                                <?php 
                                $image = get_field('integrations-doubledV2-logo-small-first');
                                $size = 'full';
                                $attr = array('class' => 'logo');
                                if($image){
                                    echo wp_get_attachment_image($image, $size, false, $attr);
                                }
                                ?>
                            </div>
                            <div class="integrations-doubledV2__box-logo logo-2-2">
                                <?php 
                                $image = get_field('integrations-doubledV2-logo-small-second');
                                $size = 'full';
                                $attr = array('class' => 'logo');
                                if($image){
                                    echo wp_get_attachment_image($image, $size, false, $attr);
                                }
                                ?>
                            </div>
                            <div class="integrations-doubledV2__box-logo logo-3-2">
                                <?php 
                                $image = get_field('integrations-doubledV2-logo-small-third');
                                $size = 'full';
                                $attr = array('class' => 'logo');
                                if($image){
                                    echo wp_get_attachment_image($image, $size, false, $attr);
                                }
                                ?>
                            </div>
                            <div class="integrations-doubledV2__box-logo logo-4-2">
                                <?php 
                                $image = get_field('integrations-doubledV2-logo-small-fourth');
                                $size = 'full';
                                $attr = array('class' => 'logo');
                                if($image){
                                    echo wp_get_attachment_image($image, $size, false, $attr);
                                }
                                ?>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="integrations-doubledV2__txt desktop fade animate">
                    <div class="integrations-doubledV2__main-title-border">
                        <span class="integrations-doubledV2__main-title h-40">
                            <?php the_field('integrations-doubledV2-title') ?>
                        </span>
                    </div>
                    <div class="integrations-doubledV2__desc-border">
                        <span class="integrations-doubledV2__desc body-18">
                            <?php the_field('integrations-doubledV2-desc') ?>
                        </span>
                    </div>
                    <div class="integrations-doubledV2__thin-info-border">
                        <span class="integrations-doubledV2__thin-info body-18">
                            <i><?php the_field('integrations-doubledV2-question') ?></i>
                        </span>
                    </div>
                    <div class="integrations-doubledV2__button-border">
                        <?php 
                        $link = get_field('integrations-doubledV2-link');
                        if($link): 
                        $link_url = $link['url'];
                        $link_title = $link['title'];
                        $link_target = $link['target'] ? $link['target'] : '_self';
                        ?>
                        <a class="integrations-doubledV2__button btn-white-to-purple"
                            href="<?php echo esc_url( $link_url ); ?>" target="<?php echo esc_attr( $link_target ); ?>">
                            <?php echo esc_html( $link_title ); ?>
                        </a>
                        <?php endif; ?>
                    </div>
                </div>
            </div>
            <div class="integrations-doubledV2__txt mobile fade animate">
                <div class="integrations-doubledV2__main-title-border">
                    <span class="integrations-doubledV2__main-title h-40">
                        <?php the_field('integrations-doubledV2-title') ?>
                    </span>
                </div>
                <div class="integrations-doubledV2__desc-border">
                    <span class="integrations-doubledV2__desc body-18">
                        <?php the_field('integrations-doubledV2-desc') ?>
                    </span>
                </div>
                <div class="integrations-doubledV2__thin-info-border">
                    <span class="integrations-doubledV2__thin-info body-18">
                        <i><?php the_field('integrations-doubledV2-question') ?></i>
                    </span>
                </div>
                <div class="integrations-doubledV2__button-border">
                    <?php 
                        $link = get_field('integrations-doubledV2-link');
                        if($link): 
                        $link_url = $link['url'];
                        $link_title = $link['title'];
                        $link_target = $link['target'] ? $link['target'] : '_self';
                        ?>
                    <a class="integrations-doubledV2__button btn-white-to-purple"
                        href="<?php echo esc_url( $link_url ); ?>" target="<?php echo esc_attr( $link_target ); ?>">
                        <?php echo esc_html( $link_title ); ?>
                    </a>
                    <?php endif; ?>
                </div>
            </div>
        </div>
    </div>
    <script>
    function animateBall(element, container, svgElement, duration, onComplete) {
        const radius = container.offsetWidth / 2;
        const centerX = container.offsetWidth / 2;
        const centerY = container.offsetHeight / 2;

        let startTime = null;
        let lastCollisionCheck = 0;

        function checkCollision() {
            const ballRect = element.getBoundingClientRect();
            const logos = document.querySelectorAll(".integrations-doubledV2__box-logo");

            logos.forEach(logo => {
                const logoRect = logo.getBoundingClientRect();
                const isInside = (
                    ballRect.left >= logoRect.left &&
                    ballRect.top >= logoRect.top &&
                    ballRect.right <= logoRect.right &&
                    ballRect.bottom <= logoRect.bottom
                );

                if (isInside) {
                    logo.classList.add("active");
                } else {
                    logo.classList.remove("active");
                }
            });
        }

        function setBallPosition(timestamp) {
            if (!startTime) startTime = timestamp;
            const elapsed = timestamp - startTime;

            const angle = (elapsed / duration) * 2 * Math.PI;
            const x = centerX + radius * Math.cos(angle);
            const y = centerY + radius * Math.sin(angle);

            element.style.transform =
                `translate(${x - element.offsetWidth / 2}px, ${y - element.offsetHeight / 2}px)`;

            const rotationAngle = (angle * 180 / Math.PI);
            svgElement.style.transform = `rotate(${rotationAngle}deg)`;

            if (elapsed - lastCollisionCheck >= 50) {
                checkCollision();
                lastCollisionCheck = elapsed;
            }

            if (elapsed < duration) {
                requestAnimationFrame(setBallPosition);
            } else {
                document.querySelectorAll(".integrations-doubledV2__box-logo").forEach(logo => {
                    logo.classList.remove("active");
                });
                svgElement.style.transform = 'rotate(0deg)';
                onComplete();
            }
        }

        requestAnimationFrame(setBallPosition);
    }

    function startAnimationCycle() {
        const bigBall = document.querySelector('.integrations-doubledV2__circle-move-big');
        const smallBall = document.querySelector('.integrations-doubledV2__circle-move-small');
        const bigContainer = document.querySelector('.integrations-doubledV2__carousel-big');
        const smallContainer = document.querySelector('.integrations-doubledV2__carousel-small');
        const bigSVG = document.querySelector('.integrations-doubledV2__svg-big svg');
        const smallSVG = document.querySelector('.integrations-doubledV2__svg-small svg');
        const bigBallDuration = 10000;
        const smallBallDuration = 8000;

        function animateBigBall() {
            bigBall.style.display = 'block';
            smallBall.style.display = 'none';

            bigSVG.classList.remove('hidden');
            bigSVG.classList.add('visible');

            smallSVG.classList.remove('visible');
            smallSVG.classList.add('hidden');

            animateBall(bigBall, bigContainer, bigSVG, bigBallDuration, () => {

                bigSVG.classList.remove('visible');
                bigSVG.classList.add('hidden');
                setTimeout(() => {
                    smallSVG.classList.remove(
                        'hidden');
                    smallSVG.classList.add('visible');
                    animateSmallBall();
                }, 2000); // Opóźnienie przed rozpoczęciem animacji małej kulki
            });
        }

        function animateSmallBall() {
            bigBall.style.display = 'none';
            smallBall.style.display = 'block';

            bigSVG.classList.remove('visible');
            bigSVG.classList.add('hidden');

            smallSVG.classList.remove('hidden');
            smallSVG.classList.add('visible');

            animateBall(smallBall, smallContainer, smallSVG, smallBallDuration, () => {
                smallSVG.classList.remove('visible');
                smallSVG.classList.add('hidden');
                setTimeout(() => {
                    bigSVG.classList.remove(
                        'hidden');
                    bigSVG.classList.add('visible');
                    animateBigBall();
                }, 2000); // Opóźnienie przed rozpoczęciem animacji dużej kulki
            });
        }

        animateBigBall();
    }

    document.addEventListener("DOMContentLoaded", () => {
        document.querySelector('.integrations-doubledV2__circle-move-small').style.display = 'none';

        document.querySelector('.integrations-doubledV2__svg-big svg').classList.add('svg-fade');
        document.querySelector('.integrations-doubledV2__svg-small svg').classList.add('svg-fade');

        startAnimationCycle();
    });
    </script>
</section>